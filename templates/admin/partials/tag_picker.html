<input type="hidden" name="tags" id="tags-input" value='{{ selected_tags|safe }}'>

<div class="flex flex-wrap gap-2 mb-3">
    <button type="button" data-tag="vegan" data-color="green" onclick="toggleTag('vegan')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-green-400">
        Wegański
    </button>
    <button type="button" data-tag="lactose-free" data-color="blue" onclick="toggleTag('lactose-free')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-blue-400">
        Bez laktozy
    </button>
    <button type="button" data-tag="new" data-color="purple" onclick="toggleTag('new')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-purple-400">
        Nowość
    </button>
    <button type="button" data-tag="hit" data-color="red" onclick="toggleTag('hit')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-red-400">
        Hit dnia
    </button>
    <button type="button" data-tag="sugar-free" data-color="amber" onclick="toggleTag('sugar-free')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-amber-400">
        Bez cukru
    </button>
    <button type="button" data-tag="seasonal" data-color="orange" onclick="toggleTag('seasonal')"
            class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600 border-2 border-transparent hover:border-orange-400">
        Sezonowy
    </button>
</div>

<div class="flex gap-2 mb-3">
    <input type="text" id="custom-tag" placeholder="Własny tag..." maxlength="20"
           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
    <button type="button" onclick="addCustomTag()" class="px-4 py-2 bg-gray-100 rounded-lg text-sm">Dodaj</button>
</div>

<p class="text-sm text-gray-500">Wybrano <span id="tag-count">0</span>/5 tagów</p>

<script>
function updateTagDisplay() {
    const input = document.getElementById('tags-input');
    const tags = JSON.parse(input.value || '[]');
    document.getElementById('tag-count').textContent = tags.length;
    document.querySelectorAll('.tag-btn').forEach(btn => {
        const tag = btn.dataset.tag;
        const color = btn.dataset.color;
        const selected = tags.includes(tag);

        if (selected) {
            // Selected state: colored background + colored border + colored text
            btn.classList.remove('bg-gray-100', 'text-gray-600', 'border-transparent');
            btn.classList.add(`bg-${color}-100`, `text-${color}-800`, `border-${color}-500`);
        } else {
            // Unselected state: neutral background + transparent border + muted text
            btn.classList.remove(`bg-${color}-100`, `text-${color}-800`, `border-${color}-500`);
            btn.classList.add('bg-gray-100', 'text-gray-600', 'border-transparent');
        }
    });
}
function toggleTag(tag) {
    const input = document.getElementById('tags-input');
    let tags = JSON.parse(input.value || '[]');
    if (tags.includes(tag)) tags = tags.filter(t => t !== tag);
    else if (tags.length < 5) tags.push(tag);
    input.value = JSON.stringify(tags);
    updateTagDisplay();
}
function addCustomTag() {
    const input = document.getElementById('custom-tag');
    const tag = input.value.trim().toLowerCase();
    if (!tag) return;
    const tagsInput = document.getElementById('tags-input');
    let tags = JSON.parse(tagsInput.value || '[]');
    if (!tags.includes(tag) && tags.length < 5) {
        tags.push(tag);
        tagsInput.value = JSON.stringify(tags);
        input.value = '';
        updateTagDisplay();
    }
}
updateTagDisplay();
</script>
